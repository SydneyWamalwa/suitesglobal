<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1024">
    <title>Booking Details</title>
   <!-- Pikaday CSS -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pikaday/1.8.2/css/pikaday.css" integrity="sha512-xoQ+h19cVJGZcB5/rFb2H4n21Y9K3hiuBOZKEwdNXv1xb/nhlt6vhbaPH3sNvejkTWwWPpuXXfmbRI0Qs/RD8Q==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<!-- Pikaday JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js" integrity="sha512-CryKbMe7sjSCDPl18jtJI5DR5jtkUWxPXWaLCst6QjH8wxDexfRJic2WRmRXmstr2Y8SxDDWuBO6CQC6IE4KTA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pikaday/1.8.2/pikaday.min.js" integrity="sha512-dkMzAitT+RFxzaHsyXAd1KtYpmuP/Jl6yOPYUu1s20dLfizq6cpbzDFNSAANb3IZbyhVhAbZxAyeqORpjkF3oQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<style>
    .body {
font-family: 'Arial', sans-serif;
background-color: #f4f4f4;
margin: 0;
padding: 0;
box-sizing: border-box;
}

.booking-details-container {
max-width: 800px;
margin: 20px auto; /* Center horizontally */
background-color: #333;
padding: 20px;
border-radius: 8px;
box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
text-align: center;
display: flex;
align-items: center; /* Center vertically */
}



.booking-details-container1 {
max-width: 400px;
background-color: white;
padding: 20px;
border-radius: 8px;
box-shadow: 0 0 10px rgba(0, 0, 0, 0.0);
text-align: center;
align-self: start;
margin-left: 0; /* Adjust the left margin as needed */
}

.booking-details-container2 {
max-width: 400px;
background-color: white;
padding: 20px;
border-radius: 8px;
box-shadow: 0 0 10px rgba(0, 0, 0, 0.0);
text-align: center;
margin-left: auto; /* This will push it to the right */
}



.property-image {
width: 100%;
height: 400px;
border-radius: 8px;
margin-bottom: 20px;
display: block;
margin-left: auto;
margin-right: auto;
}

.additional-images-container {
display: grid;
grid-template-rows: repeat(2, 1fr); /* 2 rows */
grid-template-columns: repeat(2, 1fr); /* 2 columns */
gap: 10px; /* Adjust the gap as needed */
margin-bottom: 20px;
margin-left: 50px;
margin-right: 50px;
}


.additional-image {
width: 100%; /* Adjust the width as needed */
border-radius: 8px;
overflow: hidden;
}

.additional-image img {
width: 100%;
height: 100px;
border-radius: 8px;
display: flex;
margin: 0 auto; /* Center the image */
}

h2 {
color: #3498db;
font-size: large;

}

p {
color: black;
margin-bottom: 20px;
}

.book-button {
        display: block;
        margin-top: 5px;
        padding: 8px 16px;
        background-color: #3498db;
        color: #fff;
        text-decoration: none;
        border-radius: 5px;
        text-align: center;
        cursor: pointer;
    }
.container{
display: flex;
}

.booking-details-container1,
.booking-details-container2 {
max-width: 400px;
background-color: white;
padding: 20px;
border-radius: 8px;
box-shadow: 0 0 10px rgba(0, 0, 0, 0.0);
text-align: center;
margin: 0 50px; /* Adjust the margin to reduce the distance */
}

.booking-details-container1 {
align-self: start;
margin-left: 30px; /* Adjust the left margin as needed */
}

.booking-details-container2 {
margin-left: auto; /* This will push it to the right */
}

.booking-details-container2 {
        max-width: 400px;
        margin: 20px auto;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
    }

    input {
        width: 100%;
        padding: 8px;
        margin-bottom: 16px;
        box-sizing: border-box;
    }

    button {
        background-color: #3498db;
        color: #fff;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    /* Add more styles as needed */
    /* The Modal (background) */
.modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0,0,0,0.7);
}

/* Modal Content */
.modal-content {
position: fixed;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background-color: #fefefe;
padding: 20px;
border: 1px solid #888;
}

/* Close Button */
.close {
color: #aaa;
float: right;
font-size: 28px;
font-weight: bold;
}

.close:hover,
.close:focus {
color: black;
text-decoration: none;
cursor: pointer;
}

</style>
    <!-- Include SweetAlert2 CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

<!-- Include SweetAlert2 JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>
<body>

    <div class="booking-details-container">
        <img src="/{{ destinations_data[4] }}" alt="{{ destinations_data[0] }}" class="property-image">

        <!-- Additional Images Container -->
        <div class="additional-images-container">
            <div class="additional-image">
                <img src="/{{ destinations_data[5] }}" alt="{{ destinations_data[0] }}">
            </div>
            <div class="additional-image">
                <img src="/{{ destinations_data[6] }}" alt="{{ destinations_data[0] }}">
            </div>
            <div class="additional-image">
                <img src="/{{ destinations_data[7] }}" alt="{{ destinations_data[0] }}">
            </div>
            <div class="additional-image">
                <img src="/{{ destinations_data[8] }}" alt="{{ destinations_data[0] }}">
            </div>
        </div>
        </div>
        <div class="container">
        <div class="booking-details-container1">
            <h2>Destination: <p>{{ destinations_data[1] }}</p></h2>
            <h2>Description: <p>{{ destinations_data[3] }}</p></h2><br>
            <h2>Amenities: <p>{{ destinations_data[10] }}</p></h2>
        </div>

        <div class="booking-details-container2">
            <h2>Booking Form</h2>
            <form action="/submit_destination_booking" method="post">
                <label for="destination_name">Property Name</label>
                <input type="text" id="destination_name" name="destination_name" value="{{ destinations_data[1] }}" readonly>

                <label for="guest_name">Your Name</label>
                <input type="text" id="guest_name" name="guest_name" required>

                <label for="check_in">Check-In</label>
                <input type="text" id="check_in" name="check_in" readonly>
                <button type="button" onclick="openCalendar('check_in')">Select Date</button>

                <label for="check_out">Check-Out</label>
                <input type="text" id="check_out" name="check_out" readonly>
                <button type="button" onclick="openCalendar('check_out')">Select Date</button>

                <label for="contacts">Contacts</label>
                <input type="text" id="contacts" name="contacts" required>

                <label for="guests">Number of Guests</label>
                <input type="number" id="guests" name="guests" required>

                <!-- Add more booking fields as needed -->

                <!-- Price Section -->
                <div id="price-section">
                    <h2>Price: <span id="calculated-price">{{ destinations_data[9] }}</span></h2>
                </div>

                <button type="button" onclick="showPopupForm()">Submit Booking</button>
                            </form>
        </div>

        <!-- JavaScript for Date Picker and Price Calculation -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Initialize Pikaday for date inputs
                openCalendar('check_in');
                openCalendar('check_out');

                // Calculate price on input change
                const checkInInput = document.getElementById('check_in');
                const checkOutInput = document.getElementById('check_out');
                const calculatedPrice = document.getElementById('calculated-price');

                [checkInInput, checkOutInput].forEach(input => {
                    input.addEventListener('change', calculatePrice);
                });

                function calculatePrice() {
                    // Implement your price calculation logic based on the total number of days
                    const destinationPrice = parseFloat('{{ destinations_data[9] }}'); // Get property price from the template
                    const checkInDate = new Date(document.getElementById('check_in').value);
                    const checkOutDate = new Date(document.getElementById('check_out').value);

                    // Calculate the total number of days
                    const totalDays = Math.ceil((checkOutDate - checkInDate) / (1000 * 60 * 60 * 24));

                    // Example calculation: $100 per day
                    const totalCost = totalDays * destinationPrice;

                    // Update the displayed price
                    calculatedPrice.textContent = totalCost.toFixed(2);
                }
            });

            function openCalendar(inputId) {
                // Implement logic to open a calendar and set the selected date to the corresponding input field
                // For Pikaday, use the provided code for opening the calendar
                const inputElement = document.getElementById(inputId);
                const picker = new Pikaday({
                    field: inputElement,
                    format: 'MM/DD/YYYY', // Adjust the date format as needed
                    // Add more Pikaday configurations if necessary
                });
                picker.show();
            }
        </script>






        </div>

        <!-- The Modal -->
<div id="myModal" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
        <span class="close" onclick="closePopupForm()">&times;</span>
        <!-- Your popup form content -->
        <h2>Popup Form</h2>
        <form id="paymentForm">
            <div class="form-group">
              <label for="email">Email Address</label>
              <input type="email" id="email-address" required />
            </div>
            <div class="form-group">
                <label for="amount">Amount</label>
                <input type="tel" id="amount" oninput="updateAmount()" required />
            </div>


            <div class="form-group">
              <label for="first-name">First Name</label>
              <input type="text" id="first-name" />
            </div>
            <div class="form-group">
              <label for="last-name">Last Name</label>
              <input type="text" id="last-name" />
            </div>
            <div class="form-submit">
              <button type="submit" onclick="payWithPaystack()"> Pay </button>
            </div>
          </form>

          <script src="https://js.paystack.co/v1/inline.js"></script>
    </div>
</div>
    <script>
        function showSuccessAlert() {
        Swal.fire({
            icon: 'success',
            title: 'Booking submitted successfully!',
            text: 'We have emailed you your receipt.',
            confirmButtonColor: '#4caf50', // Customize the confirm button color
        });
    }
    // Function to show the popup form
    function showPopupForm() {
        var modal = document.getElementById('myModal');
        modal.style.display = 'block';
    }

    // Function to close the popup form
    function closePopupForm() {
        var modal = document.getElementById('myModal');
        modal.style.display = 'none';
    }
    </script>

    <script>
        const paymentForm = document.getElementById('paymentForm');
        paymentForm.addEventListener("submit", payWithPaystack, false);

        function payWithPaystack(e) {
    e.preventDefault();

    let handler = PaystackPop.setup({
        key: 'pk_test_079a5e10a5252fda7d9a174d249581b3be77ea47', // Replace with your public key
        email: document.getElementById("email-address").value,
        amount: document.getElementById("amount").value * 100,
        currency:'KES',
        ref: ''+Math.floor((Math.random() * 1000000000) + 1),
        onClose: function(){
            alert('Window closed.');
        },
        callback: function(response){
            if (response.status === 'success') {
                // Payment successful, submit booking details
                submitBookingDetails();
            } else {
                // Payment failed, show an alert or take appropriate action
                alert('Payment failed: ' + response.message);
            }
        }
    });

    handler.openIframe();
}

function submitBookingDetails() {
    // Use AJAX to send the booking details to your server
    var xhr = new XMLHttpRequest();
    var url = '/submit_destination_booking'; // Update with your actual endpoint
    var params = 'destination_name=' + encodeURIComponent(document.getElementById('destination_name').value)
                + '&guest_name=' + encodeURIComponent(document.getElementById('guest_name').value)
                + '&check_in=' + encodeURIComponent(document.getElementById('check_in').value)
                + '&check_out=' + encodeURIComponent(document.getElementById('check_out').value)
                + '&guests=' + encodeURIComponent(document.getElementById('guests').value)
                + '&contacts=' +encodeURIComponent(document.getElementById('contacts').value)
                + '&amount=' + encodeURIComponent(document.getElementById('amount').value);

    xhr.open('POST', url, true);
    xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

    xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
            // Handle the response from the server
            var response = JSON.parse(xhr.responseText);
            if (response.status === 'success') {
                showSuccessAlert();
            } else {
                Swal.fire({
                        icon: 'error',
                        title: 'Booking submission failed',
                        text: response.message,
                        confirmButtonColor: '#d33', // Customize the confirm button color
                    });
            }
        }
    };

    xhr.send(params);
}

    </script>

<script>
    // Function to update the "amount" input field based on the calculated price
    function updateAmount() {
        var calculatedPrice = document.getElementById('calculated-price').innerText;
        document.getElementById('amount').value = calculatedPrice;
    }

    // ... (your existing JavaScript code)
</script>





</body>
</html>
